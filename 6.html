<!DOCTYPE>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <title>D3 Demos</title>
    <script type="text/javascript" src="d3/d3.v2.js"></script>
  </head>
  <body>
    <style type="text/css">
    </style>
    <script type="text/javascript">
      // In this example, we will see how to use
      // domains and ranges, and x and y axis

      var svg = d3.select('body').append("svg"),
          w = 300,
          h = 300,
          i = -1;

     var w = 300, h = 300;

      svg.attr({
        width: w,
        height: h
      }).style("border", "2px solid #f00"); 

      var dataset = [
        {"time": ++i, "value": 21},
        {"time": ++i, "value": 101},
        {"time": ++i, "value": 30},
        {"time": ++i, "value": 71}
      ];

      function refresh() {
        //console.log(dataset);
        var rects = svg.selectAll("rect")
                  .data(dataset, function(d) { 
                    return d.time; 
                  });

        rects
          .enter()
          .append("rect")
            .attr({
              width: 20,
              height: function(d) { return d.value },
              x: function(d) { return d.time*25 },
              y: function(d) { return 300-d.value }
            });

        rects.attr({ x: function(d) { return d.time*25; } });

        rects
          .exit()
          .remove();

        var texts = svg.selectAll("text")
          .data(dataset, function(d) { 
            return d.time; 
          });
          
        texts.enter()
          .append("text")
            .attr({
              x: function(d) { return d.time*25+10 },
              y: function(d) { return 300-d.value+10 },
              fill: "white",
              "font-family": "sans-serif",
              "font-size": 11,
              "text-anchor": "middle"
            })
            .text(function(d) {return d.value;}); 

        texts.attr({ x: function(d) { return d.time*25+10; } });

        texts
          .exit()
            .remove();

      }
      refresh();
    </script>
  </body>
</html>